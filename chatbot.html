<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Career Coach Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Styles moved to style.css -->
</head>
    <body class="chatbot-page">
        <nav class="navbar">
            <div class="navbar-content">
                <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" alt="App Logo" class="app-logo" />
                <span class="app-title">AI Career Coach Chatbot</span>
            </div>
        </nav>
        <div class="chatbot-container">
            <div class="chatbox" id="chatbox">
                <div><em>Welcome! Ask me anything about your career path or job search.</em></div>
            </div>
            <form class="input-row" onsubmit="sendMessage(event)">
                <input type="text" id="userInput" placeholder="Type your message..." autocomplete="off" required />
                <button type="submit">Send</button>
            </form>
            <a href="index.html" class="back-link">&larr; Back to Home</a>
        </div>

        <script>
        async function sendMessage(event) {
            event.preventDefault();
            const input = document.getElementById('userInput');
            const chatbox = document.getElementById('chatbox');
            const userMsg = input.value.trim();
            if (!userMsg) return;

            // Show user message
            chatbox.innerHTML += `<div><strong>You:</strong> ${userMsg}</div>`;
            input.value = '';
            chatbox.scrollTop = chatbox.scrollHeight;

            // Show loading message
            chatbox.innerHTML += `<div id="loading"><em>Coach is thinking...</em></div>`;
            chatbox.scrollTop = chatbox.scrollHeight;

            try {
                const response = await fetch('https://n8n.codeblazar.org/webhook/chatbot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: userMsg })
                });

                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();

                // Clean loading message
                document.getElementById('loading')?.remove();

                // Extract and format AI reply with line breaks
                let aiReply = data.reply || data.message || data.text || "Hmm... I couldn't process that.";
                aiReply = aiReply.replace(/\n/g, "<br>"); // Fix: Convert \n to <br>

                chatbox.innerHTML += `<div><strong>Coach:</strong> <em>${aiReply}</em></div>`;
            } catch (error) {
                document.getElementById('loading')?.remove();
                chatbox.innerHTML += `<div><strong>Coach:</strong> <em>Sorry, there was a problem contacting the AI service.</em></div>`;
                console.error('Fetch error:', error);
            }

            chatbox.scrollTop = chatbox.scrollHeight;
        }
    </script>
</body>
</html>
